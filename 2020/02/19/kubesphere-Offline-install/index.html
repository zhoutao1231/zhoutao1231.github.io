<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Pisces',
    version: '7.6.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: true,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="前言：  KubeSphere 规划了三个版本，分别是:  Community Edition （ 社区版 ）–&gt; Express Edition （ 易捷版 ）–&gt; Advanced Edition （ 高级版 ）  KubeSphere 适用于企业在数字化转型时所面临的敏捷开发与自动化运维、微服务应用架构与流量治理、自动弹性伸缩和业务高可用、DevOps 持续集成与交付等应用场景。">
<meta property="og:type" content="article">
<meta property="og:title" content="记录离线安装 KubeSphere 踩到的小坑">
<meta property="og:url" content="http://yoursite.com/2020/02/19/kubesphere-Offline-install/index.html">
<meta property="og:site_name" content="且听风语，淡看雨落">
<meta property="og:description" content="前言：  KubeSphere 规划了三个版本，分别是:  Community Edition （ 社区版 ）–&gt; Express Edition （ 易捷版 ）–&gt; Advanced Edition （ 高级版 ）  KubeSphere 适用于企业在数字化转型时所面临的敏捷开发与自动化运维、微服务应用架构与流量治理、自动弹性伸缩和业务高可用、DevOps 持续集成与交付等应用场景。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yoursite.com/images/fdisk-l.jpg">
<meta property="og:image" content="http://yoursite.com/images/installed-kubernetes.jpg">
<meta property="og:image" content="http://yoursite.com/2020/02/19/kubesphere-Offline-install/images/kubesphere_end.jpg">
<meta property="og:image" content="http://yoursite.com/images/kubesphere_web.jpg">
<meta property="og:image" content="http://yoursite.com/images/kubesphere_pc.jpg">
<meta property="og:image" content="http://yoursite.com/images/kubesphere_cctv.jpg">
<meta property="og:image" content="http://yoursite.com/images/kubesphere_service_cctv.jpg">
<meta property="article:published_time" content="2020-02-19T10:43:42.877Z">
<meta property="article:modified_time" content="2020-02-19T10:43:42.876Z">
<meta property="article:author" content="Zoey Zhou">
<meta property="article:tag" content="categories">
<meta property="article:tag" content="books">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yoursite.com/images/fdisk-l.jpg">

<link rel="canonical" href="http://yoursite.com/2020/02/19/kubesphere-Offline-install/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>记录离线安装 KubeSphere 踩到的小坑 | 且听风语，淡看雨落</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
    <a href="https://github.com/zhoutao1231" target="_blank" rel="noopener" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#70B7FD; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">且听风语，淡看雨落</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">青春荒唐我不负你</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/home" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/categories/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-books">

    <a href="/categories/books/" rel="section"><i class="fa fa-fw fa-book"></i>资料</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404.html" rel="section"><i class="fa fa-fw fa-heartbeat"></i>公益 404</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/19/kubesphere-Offline-install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Zoey Zhou">
      <meta itemprop="description" content="纸上谈来终觉浅，唯有实践出真知">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="且听风语，淡看雨落">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          记录离线安装 KubeSphere 踩到的小坑
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-19 18:43:42" itemprop="dateCreated datePublished" datetime="2020-02-19T18:43:42+08:00">2020-02-19</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/books/" itemprop="url" rel="index">
                    <span itemprop="name">books</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/books/Kubernetes/" itemprop="url" rel="index">
                    <span itemprop="name">Kubernetes</span>
                  </a>
                </span>
            </span>

          
            <span id="/2020/02/19/kubesphere-Offline-install/" class="post-meta-item leancloud_visitors" data-flag-title="记录离线安装 KubeSphere 踩到的小坑" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2020/02/19/kubesphere-Offline-install/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/02/19/kubesphere-Offline-install/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>22k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>20 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h4 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h4><p>  KubeSphere 规划了三个版本，分别是:<br>  Community Edition （ 社区版 ）–&gt; Express Edition （ 易捷版 ）–&gt; Advanced Edition （ 高级版 ）<br>  KubeSphere 适用于企业在数字化转型时所面临的敏捷开发与自动化运维、微服务应用架构与流量治理、自动弹性伸缩和业务高可用、DevOps 持续集成与交付等应用场景。<br>  更多关于 KubeSphere 的产品介绍请参考： <a href="https://kubesphere.io/docs/v2.0/zh-CN/introduction/intro/" target="_blank" rel="noopener">KubeSphere 文档中心</a> 。</p>
<a id="more"></a>
<h3 id="一、优化Linux-系统"><a href="#一、优化Linux-系统" class="headerlink" title="一、优化Linux 系统"></a>一、优化Linux 系统</h3><h4 id="1-1-准备三台-Centos-7-6-主机-虚拟机"><a href="#1-1-准备三台-Centos-7-6-主机-虚拟机" class="headerlink" title="1.1 准备三台 Centos 7.6 主机/虚拟机"></a>1.1 准备三台 Centos 7.6 主机/虚拟机</h4><p>  master 192.168.200.156  4核  8G  150GB<br>  node1 192.168.200.157   4核  6G  50GB<br>  node2 192.168.200.158   4核  6G  50GB</p>
<p>  注释与先决条件：<br>    * KubeSphere官网提供给我们的是 Community Edition （社区版），易捷版与高级版请至<a href="https://www.qingcloud.com/contactus" target="_blank" rel="noopener">QingCloud</a>咨询。<br>    * 我们是离线安装 KubeSphere ，先下载离线安装包吧。<br>    * 将我们准备的三台 Centos 7.6 内核均升级至 4.0 版本或者以上来得到更好的支持。<br>    * 测试环境提前关闭 Swap 交换分区、开启 Ipv4 转发、关闭 Selinux、关闭 Firewalld/Iptables 防火墙。<br>    * 开发环境防火墙端口配置请参考： <a href="https://kubesphere.io/docs/v2.0/zh-CN/installation/port-firewall/" target="_blank" rel="noopener">KubeSphere 需开放的端口</a> 。<br>    * 持久化存储请参考： <a href="https://kubesphere.io/docs/v2.0/zh-CN/installation/storage-configuration/" target="_blank" rel="noopener">KubeSphere 存储配置说明</a> 。<br>    * 确保SSH 能正常访问每一个节点。<br>    * 离线安装属于完全安装，对存储空间的要求非常大，Master节点建议150GB+<br>    * KubeSphere 离线安装包的上载可以使用 WinScp 进行操作 或者 直接 wget 安装包到Server</p>
<h4 id="1-2-更改主机-hostname-并将三台主机的主机名与IP写入-etc-hosts-中"><a href="#1-2-更改主机-hostname-并将三台主机的主机名与IP写入-etc-hosts-中" class="headerlink" title="1.2 更改主机 hostname 并将三台主机的主机名与IP写入 /etc/hosts 中"></a>1.2 更改主机 hostname 并将三台主机的主机名与IP写入 /etc/hosts 中</h4>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#分别更改三台主机的主机名</span></span><br><span class="line">~]<span class="comment"># echo master &gt; /etc/hostname ; ssh 192.168.200.157 "echo node1 &gt; /etc/hosts" ; ssh 192.168.200.158 "echo node2 &gt; /etc/hosts"</span></span><br><span class="line"><span class="comment">#重启三台主机使其生效</span></span><br><span class="line">~]<span class="comment"># reboot</span></span><br><span class="line"><span class="comment">#将主机名与IP写入至 /etc/hosts</span></span><br><span class="line">~]<span class="comment"># vim /etc/hosts</span></span><br><span class="line"><span class="comment">#添加如下：</span></span><br><span class="line">  master 192.168.200.156</span><br><span class="line">  node1 192.168.200.157</span><br><span class="line">  node2 192.168.200.158</span><br><span class="line">~]<span class="comment"># scp -r /etc/hosts node1:/etc/hosts</span></span><br><span class="line">~]<span class="comment"># scp -r /etc/hosts node2:/etc/hosts</span></span><br></pre></td></tr></table></figure>
<h4 id="1-3-关闭防火墙、Selinux、Swap-交换分区"><a href="#1-3-关闭防火墙、Selinux、Swap-交换分区" class="headerlink" title="1.3 关闭防火墙、Selinux、Swap 交换分区"></a>1.3 关闭防火墙、Selinux、Swap 交换分区</h4>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~]<span class="comment"># systemctl stop firewalld &amp;&amp; systemctl disable firewalld; ssh node1 "systemctl stop firewalld &amp;&amp; systemctl disable firewalld"; ssh node2 "systemctl stop firewalld &amp;&amp; systemctl disable firewalld"</span></span><br><span class="line">~]<span class="comment"># swapoff -a &amp;&amp; sed -i '/ swap / s/^\(.*\)$/#\1/g' /etc/fstab; ssh node1 "swapoff -a &amp;&amp; sed -i '/ swap / s/^\(.*\)$/#\1/g' /etc/fstab"; ssh node2 "swapoff -a &amp;&amp; sed -i '/ swap / s/^\(.*\)$/#\1/g' /etc/fstab"</span></span><br><span class="line">~]<span class="comment"># setenforce 0 &amp;&amp; sed -i 's/SELINUX=.*/SELINUX=disabled/' /etc/selinux/config; ssh node1 "setenforce 0 &amp;&amp; sed -i 's/SELINUX=.*/SELINUX=disabled/' /etc/selinux/config"; ssh node2 "setenforce 0 &amp;&amp; sed -i 's/SELINUX=.*/SELINUX=disabled/' /etc/selinux/config"</span></span><br></pre></td></tr></table></figure>
<h4 id="1-4-关闭系统不需要的服务"><a href="#1-4-关闭系统不需要的服务" class="headerlink" title="1.4 关闭系统不需要的服务"></a>1.4 关闭系统不需要的服务</h4>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~]<span class="comment"># systemctl stop postfix &amp;&amp; systemctl disable postfix; ssh node1 "systemctl stop postfix &amp;&amp; systemctl disable postfix"; ssh node2 "systemctl stop postfix &amp;&amp; systemctl disable postfix"</span></span><br></pre></td></tr></table></figure>
<h4 id="1-5-设置rsyslogd-和-systemd-journald"><a href="#1-5-设置rsyslogd-和-systemd-journald" class="headerlink" title="1.5 设置rsyslogd 和 systemd journald"></a>1.5 设置rsyslogd 和 systemd journald</h4>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">~]<span class="comment"># mkdir /var/log/journal; ssh node1 "mkdir /var/log/journal"; ssh node2 "mkdir /var/log/journal"</span></span><br><span class="line">~]<span class="comment"># mkdir /etc/systemd/journald.conf.d; ssh node1 "mkdir /etc/systemd/journald.conf.d"; ssh node2 "mkdir /etc/systemd/journald.conf.d"</span></span><br><span class="line">~]<span class="comment"># cat &gt; /etc/systemd/journald.conf.d/99-prophet.conf &lt;&lt;EOF</span></span><br><span class="line">[Journal]</span><br><span class="line"><span class="comment"># 持久化保存到磁盘</span></span><br><span class="line">Storage=persistent</span><br><span class="line"><span class="comment"># 压缩历史日志</span></span><br><span class="line">Compress=yes</span><br><span class="line">SyncIntervalSec=5m</span><br><span class="line">RateLimitInterval=30s</span><br><span class="line">RateLimitBurst=1000</span><br><span class="line"><span class="comment"># 最大占用空间 10G</span></span><br><span class="line">SystemMaxUse=10G</span><br><span class="line"><span class="comment"># 单日志文件最大 200M</span></span><br><span class="line">SystemMaxFileSize=200M</span><br><span class="line"><span class="comment"># 日志保存时间 2 周</span></span><br><span class="line">MaxRetentionSec=2week</span><br><span class="line"><span class="comment"># 不将日志转发到 syslog</span></span><br><span class="line">ForwardToSyslog=no</span><br><span class="line">EOF</span><br><span class="line">~]<span class="comment"># scp /etc/systemd/journald.conf.d/99-prophet.conf node1:/etc/systemd/journald.conf.d/99-prophet.conf</span></span><br><span class="line">~]<span class="comment"># scp /etc/systemd/journald.conf.d/99-prophet.conf node2:/etc/systemd/journald.conf.d/99-prophet.conf</span></span><br><span class="line">~]<span class="comment"># systemctl restart systemd-journald; ssh node1 "systemctl restart systemd-journald"; ssh node2 "systemctl restart systemd-journald"</span></span><br></pre></td></tr></table></figure>
<h4 id="1-6-调整内核参数，针对于K8s"><a href="#1-6-调整内核参数，针对于K8s" class="headerlink" title="1.6 调整内核参数，针对于K8s"></a>1.6 调整内核参数，针对于K8s</h4>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">~]<span class="comment"># cat &gt; kubernetes.conf &lt;&lt;EOF</span></span><br><span class="line">net.bridge.bridge-nf-call-iptables=1</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables=1</span><br><span class="line">net.ipv4.ip_forward=1</span><br><span class="line">net.ipv4.tcp_tw_recycle=0</span><br><span class="line">vm.swappiness=0 <span class="comment"># 禁止使用 swap 空间，只有当系统 OOM 时才允许使用它</span></span><br><span class="line">vm.overcommit_memory=1 <span class="comment"># 不检查物理内存是否够用</span></span><br><span class="line">vm.panic_on_oom=0 <span class="comment"># 开启 OOM</span></span><br><span class="line">fs.inotify.max_user_instances=8192</span><br><span class="line">fs.inotify.max_user_watches=1048576</span><br><span class="line">fs.file-max=52706963</span><br><span class="line">fs.nr_open=52706963</span><br><span class="line">net.ipv6.conf.all.disable_ipv6=1</span><br><span class="line">net.netfilter.nf_conntrack_max=2310720</span><br><span class="line">EOF</span><br><span class="line">~]<span class="comment"># cp kubernetes.conf /etc/sysctl.d/kubernetes.conf</span></span><br><span class="line">~]<span class="comment"># scp kubernetes.conf node1:/etc/sysctl.d/</span></span><br><span class="line">~]<span class="comment"># scp kubernetes.conf node2:/etc/sysctl.d/</span></span><br></pre></td></tr></table></figure>
<h4 id="1-7-将Centos-7-6-的内核升级到4-0版本或者4-0版本以上"><a href="#1-7-将Centos-7-6-的内核升级到4-0版本或者4-0版本以上" class="headerlink" title="1.7 将Centos 7.6 的内核升级到4.0版本或者4.0版本以上"></a>1.7 将Centos 7.6 的内核升级到4.0版本或者4.0版本以上</h4><p>  CentOS 7.x 系统自带的 3.10.x 内核存在一些 Bugs，导致运行的 Docker、Kubernetes 不稳定<br>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">~]<span class="comment"># rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm; ssh node1 "rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm"; ssh node2 "rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm"</span></span><br><span class="line"><span class="comment"># 安装完成后检查 /boot/grub2/grub.cfg 中对应内核 menuentry 中是否包含 initrd16 配置，如果没有，再安装一次！</span></span><br><span class="line">~]<span class="comment"># yum --enablerepo=elrepo-kernel install -y kernel-lt; ssh node1 "yum --enablerepo=elrepo-kernel install -y kernel-lt"; ssh node2 "yum --enablerepo=elrepo-kernel install -y kernel-lt"</span></span><br><span class="line"><span class="comment"># 设置开机从新内核启动</span></span><br><span class="line">~]<span class="comment"># grub2-set-default 'CentOS Linux (4.4.182-1.el7.elrepo.x86_64) 7 (Core)'; ssh node1 "grub2-set-default 'CentOS Linux (4.4.182-1.el7.elrepo.x86_64) 7 (Core)'"; ssh node2 "grub2-set-default 'CentOS Linux (4.4.182-1.el7.elrepo.x86_64) 7 (Core)'"</span></span><br><span class="line"><span class="comment"># 重启Master、Node个节点</span></span><br><span class="line">~]<span class="comment"># reboot</span></span><br><span class="line"><span class="comment"># 重启后安装内核源文件</span></span><br><span class="line">~]<span class="comment"># yum remove kernel-headers-3.10.0-1062.12.1.el7.x86_64 （三个节点都需要执行移除旧版本的kernel-headers）</span></span><br><span class="line">~]<span class="comment"># yum --enablerepo=elrepo-kernel install kernel-lt-devel-$(uname -r) kernel-lt-headers-$(uname -r); ssh node1 "yum --enablerepo=elrepo-kernel install kernel-lt-devel-$(uname -r) kernel-lt-headers-$(uname -r)"; ssh node2 "yum --enablerepo=elrepo-kernel install kernel-lt-devel-$(uname -r) kernel-lt-headers-$(uname -r)"</span></span><br><span class="line">~]<span class="comment"># yum -y install gcc  gcc-c++  gcc-gfortran glibc-devel glibc-headers libquadmath-devel libtool systemtap systemtap-devel; ssh node1 "yum -y install gcc  gcc-c++  gcc-gfortran glibc-devel glibc-headers libquadmath-devel libtool systemtap systemtap-devel"; ssh node2 "yum -y install gcc  gcc-c++  gcc-gfortran glibc-devel glibc-headers libquadmath-devel libtool systemtap systemtap-devel"</span></span><br><span class="line"><span class="comment">#查看内核版本是否为4.0版本以上</span></span><br><span class="line">~]<span class="comment"># uname -r</span></span><br></pre></td></tr></table></figure></p>
<h4 id="1-8-配置-kube-proxy-开启-ipvs-的前置条件（此操作可以不用进行，但可以用于-kubeadm-部署方式开启-kube-proxy-ipvs）"><a href="#1-8-配置-kube-proxy-开启-ipvs-的前置条件（此操作可以不用进行，但可以用于-kubeadm-部署方式开启-kube-proxy-ipvs）" class="headerlink" title="1.8 配置 kube-proxy 开启 ipvs 的前置条件（此操作可以不用进行，但可以用于 kubeadm 部署方式开启 kube-proxy ipvs）"></a>1.8 配置 kube-proxy 开启 ipvs 的前置条件（此操作可以不用进行，但可以用于 kubeadm 部署方式开启 kube-proxy ipvs）</h4>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">~]<span class="comment"># modprobe br_netfilter; ssh node1 "modprobe br_netfilter"; ssh node2 "modprobe br_netfilter"</span></span><br><span class="line">~]<span class="comment"># cat &gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt;EOF</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">modprobe -- ip_vs</span><br><span class="line">modprobe -- ip_vs_rr</span><br><span class="line">modprobe -- ip_vs_wrr</span><br><span class="line">modprobe -- ip_vs_sh</span><br><span class="line">modprobe -- nf_conntrack_ipv4</span><br><span class="line">EOF</span><br><span class="line">~]<span class="comment"># scp /etc/sysconfig/modules/ipvs.modules node1:/etc/sysconfig/modules/ipvs.modules; scp /etc/sysconfig/modules/ipvs.modules node2:/etc/sysconfig/modules/ipvs.modules</span></span><br><span class="line">~]<span class="comment"># chmod 755 /etc/sysconfig/modules/ipvs.modules &amp;&amp; bash /etc/sysconfig/modules/ipvs.modules &amp;&amp; lsmod | grep -e ip_vs -e nf_conntrack_ipv4; ssh node1 "chmod 755 /etc/sysconfig/modules/ipvs.modules &amp;&amp; bash /etc/sysconfig/modules/ipvs.modules &amp;&amp; lsmod | grep -e ip_vs -e nf_conntrack_ipv4"; ssh node2 "chmod 755 /etc/sysconfig/modules/ipvs.modules &amp;&amp; bash /etc/sysconfig/modules/ipvs.modules &amp;&amp; lsmod | grep -e ip_vs -e nf_conntrack_ipv4"</span></span><br></pre></td></tr></table></figure>
<h3 id="二、安装-KubeSphere"><a href="#二、安装-KubeSphere" class="headerlink" title="二、安装 KubeSphere"></a>二、安装 KubeSphere</h3><h4 id="2-1-拉取-KubeSphere-离线安装包并分配磁盘空间"><a href="#2-1-拉取-KubeSphere-离线安装包并分配磁盘空间" class="headerlink" title="2.1 拉取 KubeSphere 离线安装包并分配磁盘空间"></a>2.1 拉取 KubeSphere 离线安装包并分配磁盘空间</h4><h5 id="2-1-1-KubeSphere-载点："><a href="#2-1-1-KubeSphere-载点：" class="headerlink" title="2.1.1 KubeSphere 载点："></a>2.1.1 KubeSphere 载点：</h5><p>   <a href="https://pan.baidu.com/s/1CxDHsElvvBBM1kp8AqGwDQ" target="_blank" rel="noopener">百度云</a> 提取码：1izo<br>   <a href="https://kubesphere.com.cn/forum/d/230-v2-1-0" target="_blank" rel="noopener">v2.1.0离线部署包</a></p>
<h5 id="2-1-2-master节点创建磁盘3、4："><a href="#2-1-2-master节点创建磁盘3、4：" class="headerlink" title="2.1.2 master节点创建磁盘3、4："></a>2.1.2 master节点创建磁盘3、4：</h5><ul>
<li>KubeSphere 离线安装包解压后大概会有29GB的空间占用量，（sda3 给了30GB用于存储解压后的文件）</li>
<li>sda4 用于挂载至 /var/lib/docker 目录，避免安装时默认路径 /var/lib/docker 目录空间不够使用，存储空间不足报错如下：<br>ERROR: Service ‘XXX’ failed to build: write /var/lib/docker/tmp/GetImageBlob239544438: no space left on device<br><img src="/images/fdisk-l.jpg" alt=""><br>创建磁盘完毕 reboot master<h5 id="2-1-3-初始化磁盘并解压离线包："><a href="#2-1-3-初始化磁盘并解压离线包：" class="headerlink" title="2.1.3 初始化磁盘并解压离线包："></a>2.1.3 初始化磁盘并解压离线包：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">~]<span class="comment"># mkfs.ext4 /dev/sda3</span></span><br><span class="line">~]<span class="comment"># mkfs.ext4 /dev/sda4</span></span><br><span class="line"><span class="comment">#创建 临时挂载目录与docker默认存储目录</span></span><br><span class="line">~]<span class="comment"># mkdir -p /var/lib/docker</span></span><br><span class="line">~]<span class="comment"># mkdir -p /mnt/kubesphere</span></span><br><span class="line"><span class="comment">#挂载</span></span><br><span class="line">~]<span class="comment"># mount /dev/sda3 /mnt/kubesphere</span></span><br><span class="line">~]<span class="comment"># mount /dev/sda4 /var/lib/docker</span></span><br><span class="line"><span class="comment">#df确认是否正常挂载至目录，注意：在不编辑 /etc/fstab 文件的情况下这两个目录都是处于临时挂载。</span></span><br><span class="line">~]<span class="comment"># df -lh</span></span><br><span class="line"><span class="comment">#将下载好的离线包解压至 /mnt/kubesphere 临时目录</span></span><br><span class="line">~]<span class="comment"># tar -zxf kubesphere-all-offline-v2.1.0.tar.gz -C /mnt/kubesphere &amp;&amp; cd /mnt/kubesphere/kubesphere-all-offline-v2.1.0/conf</span></span><br><span class="line"><span class="comment">#解压完成后，编辑 hosts.ini 将IP 改为自己 master、node节点的IP 和 password</span></span><br><span class="line">~]<span class="comment"># vim hosts.ini</span></span><br><span class="line">[all]</span><br><span class="line">master ansible_connection=<span class="built_in">local</span>  ip=192.168.200.156</span><br><span class="line">node1  ansible_host=192.168.200.157  ip=192.168.200.157  ansible_ssh_pass=redhat</span><br><span class="line">node2  ansible_host=192.168.200.158  ip=192.168.200.158  ansible_ssh_pass=redhat</span><br><span class="line"></span><br><span class="line">[<span class="built_in">local</span>-registry]</span><br><span class="line">master</span><br><span class="line"></span><br><span class="line">[kube-master]</span><br><span class="line">master</span><br><span class="line"></span><br><span class="line">[kube-node]</span><br><span class="line">master</span><br><span class="line">node1</span><br><span class="line">node2</span><br><span class="line"></span><br><span class="line">[etcd]</span><br><span class="line">master</span><br><span class="line"></span><br><span class="line">[k8s-cluster:children]</span><br><span class="line">kube-node</span><br><span class="line">kube-master</span><br><span class="line"><span class="comment">#确认后保存退出</span></span><br></pre></td></tr></table></figure>
<h5 id="2-1-4-根据自己的需求配置-common-yaml-插件目录"><a href="#2-1-4-根据自己的需求配置-common-yaml-插件目录" class="headerlink" title="2.1.4 根据自己的需求配置 common.yaml 插件目录"></a>2.1.4 根据自己的需求配置 common.yaml 插件目录</h5>注意：想要将全部的应用开启，至少要达到官网推荐的 CPU 8核 内存16G 虚拟机配置。<br>所以可以先最小化安装后，再使用 kubectl edit cm -n kubesphere-system ks-installer 进行更新<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br></pre></td><td class="code"><pre><span class="line">  cat &gt; /mnt/kubesphere/kubesphere-all-offline-v2.1.0/conf/common.yaml &lt;&lt; EOF</span><br><span class="line">  <span class="comment">######################### Kubernetes #########################</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># The supported Kubernetes to install. Note: not all</span></span><br><span class="line">  <span class="comment"># Kubernetes versions are supported by KubeSphere, visit</span></span><br><span class="line">  <span class="comment"># https://kubesphere.io/docs to get full support list.</span></span><br><span class="line">  <span class="comment"># 默认安装的 Kubernetes 版本</span></span><br><span class="line">  kube_version: v1.15.5  </span><br><span class="line"></span><br><span class="line">  <span class="comment"># The supported etcd to install. Note: not all</span></span><br><span class="line">  <span class="comment"># etcd versions are supported by KubeSphere, visit</span></span><br><span class="line">  <span class="comment"># https://kubesphere.io/docs to get full support list.</span></span><br><span class="line">  <span class="comment"># 默认安装的 etcd 版本</span></span><br><span class="line">  etcd_version: v3.2.18   </span><br><span class="line"></span><br><span class="line">  <span class="comment"># Configure a cron job to backup etcd data, which is running on etcd host machines.</span></span><br><span class="line">  <span class="comment"># Period of running backup etcd job, the unit is minutes.</span></span><br><span class="line">  <span class="comment"># 30 as default, means backup etcd every 30 minutes.</span></span><br><span class="line">  <span class="comment"># etcd 备份的周期，默认为 30 分钟</span></span><br><span class="line">  etcd_backup_period: 30  </span><br><span class="line"></span><br><span class="line">  <span class="comment"># How many backup replicas to keep.</span></span><br><span class="line">  <span class="comment"># 5 means to keep latest 5 backups, older ones will be deleted by order.</span></span><br><span class="line">  <span class="comment"># 默认保留最近 5 次备份的数据</span></span><br><span class="line">  keep_backup_number: 5  </span><br><span class="line"></span><br><span class="line">  <span class="comment"># The location to store etcd backups files on etcd host machines.</span></span><br><span class="line">  <span class="comment"># 默认备份的目录为 "/var/backups/kube_etcd"</span></span><br><span class="line">  etcd_backup_dir: <span class="string">"/var/backups/kube_etcd"</span>  </span><br><span class="line"></span><br><span class="line">  <span class="comment">## Add other registry.  </span></span><br><span class="line">  <span class="comment"># 镜像仓库的 mirror 仓库，可以加快镜像下载 (国外地区下载可将此参数注释)</span></span><br><span class="line">  docker_registry_mirrors:</span><br><span class="line">    - https://docker.mirrors.ustc.edu.cn</span><br><span class="line">    - https://registry.docker-cn.com</span><br><span class="line">    - https://mirror.aliyuncs.com</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Kubernetes network plugin. Note that calico and flannel</span></span><br><span class="line">  <span class="comment"># are recommended plugins, which are tested and verified by KubeSphere.</span></span><br><span class="line">  <span class="comment"># Kubernetes 网络插件，支持 Calico 与 Flannel，默认 Calico</span></span><br><span class="line">  kube_network_plugin: flannel</span><br><span class="line"></span><br><span class="line">  <span class="comment"># A valid CIDR range for Kubernetes services,</span></span><br><span class="line">  <span class="comment"># 1. should not overlap with node subnet</span></span><br><span class="line">  <span class="comment"># 2. should not overlap with Kubernetes pod subnet</span></span><br><span class="line">  <span class="comment"># Kubernetes Service 的 IP 地址段（需要是有效的未被使用的地址段），不与节点所在的子网重复，不与 Kubernetes Pod 子网重复</span></span><br><span class="line">  <span class="comment">#kube_service_addresses: 10.233.0.0/18</span></span><br><span class="line">  kube_service_addresses: 10.96.0.0/16</span><br><span class="line"></span><br><span class="line">  <span class="comment"># A valid CIDR range for Kubernetes pod subnet,</span></span><br><span class="line">  <span class="comment"># 1. should not overlap with node subnet</span></span><br><span class="line">  <span class="comment"># 2. should not overlap with Kubernetes services subnet</span></span><br><span class="line">  <span class="comment"># Kubernetes Pod 子网的 IP 地址段（需要是未被使用的地址段），不与节点所在的子网重复，不与 Kubernetes Pod 子网重复，系统将从这个地址段中分配 IP 给每一个 Pod</span></span><br><span class="line">  <span class="comment"># kube_pods_subnet: 10.233.64.0/18</span></span><br><span class="line">  kube_pods_subnet: 10.244.0.0/16</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Kube-proxy proxyMode configuration, either ipvs, or iptables</span></span><br><span class="line">  <span class="comment"># kube-proxy 模式默认 ipvs (支持 ipvs, iptables)</span></span><br><span class="line">  kube_proxy_mode: ipvs</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Maximum pods allowed to run on every node.</span></span><br><span class="line">  <span class="comment"># 单个节点默认的 Pod 数量上限</span></span><br><span class="line">  kubelet_max_pods: 110</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Enable nodelocal dns cache</span></span><br><span class="line">  <span class="comment"># 是否允许通过在集群节点上以 Deamonset 的方式运行 DNS 缓存代理来提高集群的 DNS 性能。</span></span><br><span class="line">  <span class="comment"># 参考 https://github.com/kubernetes-sigs/kubespray/blob/master/docs/dns-stack.md#nodelocal-dns-cache</span></span><br><span class="line">  enable_nodelocaldns: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  pkg_download_port: 5080</span><br><span class="line">  local_registry: <span class="string">"&#123;&#123; hostvars[groups['local-registry'][0]]['ip'] | default(hostvars[groups['local-registry'][0]]['ansible_default_ipv4']['address']) &#125;&#125;:5000"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment"># HA(Highly Available) loadbalancer example config</span></span><br><span class="line">  <span class="comment"># apiserver_loadbalancer_domain_name: "lb.kubesphere.local"</span></span><br><span class="line">  <span class="comment"># loadbalancer_apiserver:    # 外部的负载均衡器配置项，用于高可用部署，当高可用部署时需取消注释</span></span><br><span class="line">  <span class="comment">#   address: 192.168.0.10    # 外部负载均衡器地址，例如阿里云 SLB、AWS NLB、青云 QingCloud 负载均衡器</span></span><br><span class="line">  <span class="comment">#   port: 6443               # 外部负载均衡器端口</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">######################### Common Storage #########################</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># This section will configure storage to use in Kubernetes.</span></span><br><span class="line">  <span class="comment"># For full supported storage list, please check</span></span><br><span class="line">  <span class="comment"># https://docs.kubesphere.io/v2.1/zh-CN/installation/storage-configuration</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># LOCAL VOLUME</span></span><br><span class="line">  <span class="comment"># Local Volume 表示挂载的本地存储设备，如磁盘、分区或目录，仅建议用于测试部署与开发环境.</span></span><br><span class="line">  <span class="comment"># 是否使用 local volume 作为持久化存储， 是：true；否：false</span></span><br><span class="line">  local_volume_enabled: <span class="literal">false</span></span><br><span class="line">  <span class="comment"># 是否设定为默认存储类型， 是：true；否：false</span></span><br><span class="line">  local_volume_is_default_class: <span class="literal">false</span></span><br><span class="line">  <span class="comment"># 存储类型的名称， 默认：local</span></span><br><span class="line">  local_volume_storage_class: <span class="built_in">local</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment"># CEPH RBD # Ceph RBD 是一个分布式存储系统</span></span><br><span class="line">  <span class="comment"># 是否使用 Ceph RBD 作为持久化存储，是：true；否：false</span></span><br><span class="line">  <span class="comment"># ceph RBD 详细配置请参考：&lt;a href="https://kubernetes.io/docs/concepts/storage/storage-classes/#ceph-rbd"&gt;kubernetes 官方文档&lt;/a&gt;</span></span><br><span class="line">  ceph_rbd_enabled: <span class="literal">false</span></span><br><span class="line">  <span class="comment"># 是否设定为默认存储类型， 是：true；否：false</span></span><br><span class="line">  ceph_rbd_is_default_class: <span class="literal">false</span></span><br><span class="line">  <span class="comment"># 存储类型名称</span></span><br><span class="line">  ceph_rbd_storage_class: rbd</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Ceph rbd monitor endpoints, for example</span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># ceph_rbd_monitors:</span></span><br><span class="line">  <span class="comment">#   - 172.24.0.1:6789</span></span><br><span class="line">  <span class="comment">#   - 172.24.0.2:6789</span></span><br><span class="line">  <span class="comment">#   - 172.24.0.3:6789</span></span><br><span class="line">  ceph_rbd_monitors:</span><br><span class="line">    - SHOULD_BE_REPLACED</span><br><span class="line"></span><br><span class="line">  <span class="comment"># ceph admin account name</span></span><br><span class="line">  ceph_rbd_admin_id: admin</span><br><span class="line"></span><br><span class="line">  <span class="comment"># ceph admin secret, for example,</span></span><br><span class="line">  <span class="comment"># ceph_rbd_admin_secret: AQAnwihbXo+uDxAAD0HmWziVgTaAdai90IzZ6Q==</span></span><br><span class="line">  ceph_rbd_admin_secret: TYPE_ADMIN_ACCOUNT_HERE</span><br><span class="line">  ceph_rbd_pool: rbd</span><br><span class="line">  ceph_rbd_user_id: admin</span><br><span class="line">  <span class="comment"># e.g. ceph_rbd_user_secret: AQAnwihbXo+uDxAAD0HmWziVgTaAdai90IzZ6Q==</span></span><br><span class="line">  ceph_rbd_user_secret: TYPE_ADMIN_SECRET_HERE</span><br><span class="line">  ceph_rbd_fsType: ext4</span><br><span class="line">  ceph_rbd_imageFormat: 1</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Additional ceph configurations</span></span><br><span class="line">  <span class="comment"># ceph_rbd_imageFeatures: layering</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment"># NFS CONFIGURATION</span></span><br><span class="line">  <span class="comment">#是否使用 NFS 作为持久化存储，是：true；否：false</span></span><br><span class="line">  <span class="comment">#是否设定为默认存储类型，是：true；否：false</span></span><br><span class="line">  <span class="comment">#注：系统中存在多种存储类型时，只能设定一种为默认存储类型</span></span><br><span class="line">  nfs_client_enabled: <span class="literal">true</span></span><br><span class="line">  nfs_client_is_default_class: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Hostname of the NFS server(ip or hostname)</span></span><br><span class="line">  <span class="comment"># 允许其访问的 NFS 服务端地址，可以是 IP 或 Hostname</span></span><br><span class="line">  nfs_server: 192.168.200.156</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Basepath of the mount point</span></span><br><span class="line">  <span class="comment">#NFS 共享目录，即服务器上共享出去的文件目录，可参考 &lt;a href="https://kubernetes.io/docs/concepts/storage/volumes/#nfs"&gt;Kubernetes 官方文档&lt;/a&gt;</span></span><br><span class="line">  nfs_path: /nfs/data</span><br><span class="line">  <span class="comment"># 指定要使用的 NFS 协议版本，默认 false 表示 v4，设置 true 则为 v3</span></span><br><span class="line">  nfs_vers3_enabled: <span class="literal">false</span></span><br><span class="line">  <span class="comment"># 指定 archiveOnDelete 为 false 时，则会自动删除 oldPath 下的所有数据，即 Pod 对应的数据持久化存储数据</span></span><br><span class="line">  nfs_archiveOnDelete: <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment"># GLUSTERFS CONFIGURATION</span></span><br><span class="line">  <span class="comment"># change to true to use glusterfs as backend storage service.</span></span><br><span class="line">  <span class="comment"># for more detailed configuration, please check</span></span><br><span class="line">  <span class="comment"># https://docs.kubesphere.io/v2.1/zh-CN/installation/storage-configuration</span></span><br><span class="line">  glusterfs_provisioner_enabled: <span class="literal">false</span></span><br><span class="line">  glusterfs_provisioner_is_default_class: <span class="literal">false</span></span><br><span class="line">  glusterfs_provisioner_storage_class: glusterfs</span><br><span class="line">  glusterfs_provisioner_restauthenabled: <span class="literal">true</span></span><br><span class="line">  <span class="comment"># e.g. glusterfs_provisioner_resturl: http://192.168.0.4:8080</span></span><br><span class="line">  glusterfs_provisioner_resturl: SHOULD_BE_REPLACED</span><br><span class="line">  <span class="comment"># e.g. glusterfs_provisioner_clusterid: 6a6792ed25405eaa6302da99f2f5e24b</span></span><br><span class="line">  glusterfs_provisioner_clusterid: SHOULD_BE_REPLACED</span><br><span class="line">  glusterfs_provisioner_restuser: admin</span><br><span class="line">  glusterfs_provisioner_secretName: heketi-secret</span><br><span class="line">  glusterfs_provisioner_gidMin: 40000</span><br><span class="line">  glusterfs_provisioner_gidMax: 50000</span><br><span class="line">  glusterfs_provisioner_volumetype: replicate:2</span><br><span class="line">  <span class="comment"># e.g. jwt_admin_key: 123456</span></span><br><span class="line">  jwt_admin_key: SHOULD_BE_REPLACED</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">######################### KubeSphere #########################</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Version of KubeSphere</span></span><br><span class="line">  ks_version: v2.1.0</span><br><span class="line"></span><br><span class="line">  <span class="comment"># KubeSphere console port, range 30000-32767,</span></span><br><span class="line">  <span class="comment"># but 30180/30280/30380 are reserved for internal service</span></span><br><span class="line">  <span class="comment"># KubeSphere 控制台默认端口</span></span><br><span class="line">  console_port: 30880</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Enable Multi users login.</span></span><br><span class="line">  <span class="comment"># false means allowing only one active session to access KubeSphere for same account.</span></span><br><span class="line">  <span class="comment"># Duplicated login action will cause previous session invalid and</span></span><br><span class="line">  <span class="comment"># that user will be logged out by force.</span></span><br><span class="line">  enable_multi_login: <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># devops/openpitrix/notification/alerting components depend on</span></span><br><span class="line">  <span class="comment"># mysql/minio/etcd/openldap/redis to store credentials.</span></span><br><span class="line">  <span class="comment"># Configure parameters below to set how much storage they use.</span></span><br><span class="line">  mysql_volume_size: 20Gi   <span class="comment"># MySQL 存储卷大小</span></span><br><span class="line">  minio_volume_size: 20Gi   <span class="comment"># Minio 存储卷大小</span></span><br><span class="line">  etcd_volume_size: 20Gi    <span class="comment"># etcd 存储卷大小</span></span><br><span class="line">  openldap_volume_size: 2Gi <span class="comment"># openldap 存储卷大小</span></span><br><span class="line">  redis_volume_size: 2Gi    <span class="comment"># Redis 存储卷大小</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment"># MONITORING CONFIGURATION</span></span><br><span class="line">  <span class="comment">#	Prometheus 副本数，默认 2，两个副本的 Prometheus 分别负责不同数据源的监控，同时保证高可用</span></span><br><span class="line">  prometheus_replicas: 2</span><br><span class="line"></span><br><span class="line">  <span class="comment"># prometheus pod memory requests</span></span><br><span class="line">  <span class="comment"># Prometheus 内存请求大小</span></span><br><span class="line">  prometheus_memory_request: 400Mi</span><br><span class="line"></span><br><span class="line">  <span class="comment"># prometheus storage size,</span></span><br><span class="line">  <span class="comment"># Prometheus 存储卷大小</span></span><br><span class="line">  <span class="comment"># 20Gi means every prometheus replica consumes 20Gi storage</span></span><br><span class="line">  prometheus_volume_size: 20Gi</span><br><span class="line"></span><br><span class="line">  <span class="comment"># whether to install a grafana</span></span><br><span class="line">  <span class="comment"># 是否额外安装 grafana，若需要自定义监控则开启</span></span><br><span class="line">  grafana_enabled: <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># LOGGING CONFIGURATION</span></span><br><span class="line">  <span class="comment"># logging is an optional component when installing KubeSphere, and</span></span><br><span class="line">  <span class="comment"># Kubernetes builtin logging APIs will be used if logging_enabled is set to false.</span></span><br><span class="line">  <span class="comment"># Builtin logging only provides limited functions, so recommend to enable logging.</span></span><br><span class="line">  logging_enabled: <span class="literal">true</span>    <span class="comment"># 是否安装内置的日志系统</span></span><br><span class="line">  elasticsearch_master_replicas: 1    <span class="comment"># es 主节点副本数，主节点数不能为偶数</span></span><br><span class="line">  elasticsearch_data_replicas: 2      <span class="comment"># 数据节点副本数</span></span><br><span class="line">  logsidecar_replicas: 2              </span><br><span class="line">  elasticsearch_volume_size: 20Gi     <span class="comment"># Elasticsearch 存储卷大小</span></span><br><span class="line">  log_max_age: 7                      <span class="comment"># 集群内置的 Elasticsearch 中日志保留时间，默认是 7 天</span></span><br><span class="line">  elk_prefix: logstash                <span class="comment"># 自定义 index 命名方式，index 将以 ks-&lt;elk_prefix&gt;-log 形式命名</span></span><br><span class="line">  kibana_enabled: <span class="literal">false</span>               <span class="comment"># 是否部署内置的 Kibana</span></span><br><span class="line">  <span class="comment">#external_es_url: SHOULD_BE_REPLACED      # 安装支持对接外部的 Elasticsearch 7.x，可减少资源消耗，此处填写 ES 服务的地址</span></span><br><span class="line">  <span class="comment">#external_es_port: SHOULD_BE_REPLACED     # 此处填写 ES 服务暴露的端口号</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># DEVOPS CONFIGURATION</span></span><br><span class="line">  <span class="comment"># Devops is an optional component for KubeSphere.</span></span><br><span class="line">  devops_enabled: <span class="literal">true</span>        <span class="comment"># 是否安装内置的 DevOps 系统（支持流水线、 S2i 和 B2i 等功能）</span></span><br><span class="line">  jenkins_memory_lim: 4Gi     <span class="comment"># Jenkins 内存限制，默认 8 Gi</span></span><br><span class="line">  jenkins_memory_req: 2Gi     <span class="comment"># Jenkins 内存请求，默认 4 Gi</span></span><br><span class="line">  jenkins_volume_size: 8Gi    <span class="comment"># Jenkins 存储卷大小，默认 8 Gi</span></span><br><span class="line">  jenkinsJavaOpts_Xms: 2g     <span class="comment"># 以下三项为 jvm 启动参数</span></span><br><span class="line">  jenkinsJavaOpts_Xmx: 4g</span><br><span class="line">  jenkinsJavaOpts_MaxRAM: 5g</span><br><span class="line">  sonarqube_enabled: <span class="literal">false</span>    <span class="comment"># 是否安装内置的 SonarQube （代码静态分析工具）</span></span><br><span class="line">  <span class="comment">#sonar_server_url: SHOULD_BE_REPLACED   # 安装支持对接外部已有的 SonarQube，此处填写 SonarQube 服务的地址</span></span><br><span class="line">  <span class="comment">#sonar_server_token: SHOULD_BE_REPLACED # 此处填写 SonarQube 的 Token</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Following components are all optional for KubeSphere,</span></span><br><span class="line">  <span class="comment"># Which could be turned on to install it before installation or later by updating its value to true</span></span><br><span class="line">  openpitrix_enabled: <span class="literal">true</span>          <span class="comment"># KubeSphere 应用商店</span></span><br><span class="line">  metrics_server_enabled: <span class="literal">false</span>     <span class="comment"># KubeSphere HPA（弹性伸缩）</span></span><br><span class="line">  servicemesh_enabled: <span class="literal">true</span>         <span class="comment"># KubeSphere Service Mesh</span></span><br><span class="line">  notification_enabled: <span class="literal">true</span>        <span class="comment"># KubeSphere 通知系统</span></span><br><span class="line">  alerting_enabled: <span class="literal">true</span>            <span class="comment"># KubeSphere 告警系统</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Harbor is an optional component for KubeSphere.</span></span><br><span class="line">  <span class="comment"># Which could be turned on to install it before installation or later by updating its value to true</span></span><br><span class="line">  <span class="comment"># 是否开启 Harbor 私有仓库，Http访问端口为：30280</span></span><br><span class="line">  harbor_enabled: <span class="literal">true</span>          <span class="comment"># Harbor 私有镜像仓库（内置 Harbor 仅建议测试环境使用，生产环境建议单独部署 Harbor）</span></span><br><span class="line">  <span class="comment">#harbor_domain: harbor.devops.kubesphere.local</span></span><br><span class="line">  harbor_domain: harbor.qiyue123.com</span><br><span class="line">  <span class="comment"># GitLab is an optional component for KubeSphere.</span></span><br><span class="line">  <span class="comment"># Which could be turned on to install it before installation or later by updating its value to true</span></span><br><span class="line">  <span class="comment"># 是否开启 Gitlab ， Http访问端口为：30080  Https端口为：30443</span></span><br><span class="line">  gitlab_enabled: <span class="literal">true</span>          <span class="comment"># GitLab （内置 GitLab 仅建议测试环境使用，生产环境建议单独部署 GitLab）</span></span><br><span class="line">  <span class="comment">#gitlab_hosts_domain: devops.kubesphere.local</span></span><br><span class="line">  gitlab_hosts_domain: gitlab.qiyue123.com</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Container Engine Acceleration</span></span><br><span class="line">  <span class="comment"># Use nvidia gpu acceleration in containers</span></span><br><span class="line">  <span class="comment"># KubeSphere currently support Nvidia GPU V100 P100 1060 1080 1080Ti</span></span><br><span class="line">  <span class="comment"># The driver version is 387.26，cuda is 9.1</span></span><br><span class="line">  <span class="comment"># 安装是否开启 Nvidia GPU 加速，安装支持 GPU 节点，也支持 CPU 与 GPU 的混合部署</span></span><br><span class="line">  <span class="comment"># nvidia_accelerator_enabled: true  </span></span><br><span class="line">  <span class="comment"># hosts.ini 中要开启 GPU 加速的节点名称，目前仅支持 Ubuntu 16.04</span></span><br><span class="line">  <span class="comment"># nvidia_gpu_nodes:</span></span><br><span class="line">  <span class="comment"># 例如这里设置节点名为 kube-gpu-001 的机器为 GPU 节点，若有多个 GPU 节点则在其下方继续添加</span></span><br><span class="line">  <span class="comment">#   - kube-gpu-001</span></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<h4 id="2-2-根据刚才配置的-common-yaml-文件安装我们需要的-Nfs-存储"><a href="#2-2-根据刚才配置的-common-yaml-文件安装我们需要的-Nfs-存储" class="headerlink" title="2.2 根据刚才配置的 common.yaml 文件安装我们需要的 Nfs 存储"></a>2.2 根据刚才配置的 common.yaml 文件安装我们需要的 Nfs 存储</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#master节点安装nfs</span></span><br><span class="line">~]<span class="comment"># yum -y install nfs-utils</span></span><br><span class="line"><span class="comment">#创建nfs目录</span></span><br><span class="line">~]<span class="comment"># mkdir -p /nfs/data/</span></span><br><span class="line"><span class="comment">#修改权限</span></span><br><span class="line">~]<span class="comment"># chmod -R 775 /nfs/data</span></span><br><span class="line"><span class="comment">#编辑export文件</span></span><br><span class="line">~]<span class="comment"># vim /etc/exports</span></span><br><span class="line">/nfs/data *(rw,no_root_squash,sync)</span><br><span class="line"><span class="comment">#配置生效</span></span><br><span class="line">~]<span class="comment"># exportfs -r</span></span><br><span class="line"><span class="comment">#查看生效</span></span><br><span class="line">~]<span class="comment"># exportfs</span></span><br><span class="line"><span class="comment">#启动rpcbind、nfs服务</span></span><br><span class="line">~]<span class="comment"># systemctl restart rpcbind &amp;&amp; systemctl enable rpcbind</span></span><br><span class="line">~]<span class="comment"># systemctl restart nfs &amp;&amp; systemctl enable nfs</span></span><br><span class="line"><span class="comment">#查看 RPC 服务的注册状况</span></span><br><span class="line">~]<span class="comment"># rpcinfo -p localhost</span></span><br><span class="line"><span class="comment">#showmount测试</span></span><br><span class="line">~]<span class="comment"># showmount -e 192.168.200.156</span></span><br><span class="line"><span class="comment">#所有node节点安装客户端</span></span><br><span class="line">~]<span class="comment"># yum -y install nfs-utils</span></span><br><span class="line">~]<span class="comment"># systemctl start nfs &amp;&amp; systemctl enable nfs</span></span><br></pre></td></tr></table></figure>
<h5 id="2-2-1-为-Gitlab-和-Harbor-添加本地解析（自己的PC电脑也需要添加解析才能正常访问哦）"><a href="#2-2-1-为-Gitlab-和-Harbor-添加本地解析（自己的PC电脑也需要添加解析才能正常访问哦）" class="headerlink" title="2.2.1 为 Gitlab 和 Harbor 添加本地解析（自己的PC电脑也需要添加解析才能正常访问哦）"></a>2.2.1 为 Gitlab 和 Harbor 添加本地解析（自己的PC电脑也需要添加解析才能正常访问哦）</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~]<span class="comment"># echo 192.168.200.156  harbor.qiyue123.com &gt;&gt; /etc/hosts</span></span><br><span class="line">~]<span class="comment"># echo 192.168.200.156  gitlab.qiyue123.com &gt;&gt; /etc/hosts</span></span><br></pre></td></tr></table></figure>
<h4 id="2-3-Install-KubeSphere"><a href="#2-3-Install-KubeSphere" class="headerlink" title="2.3 Install KubeSphere"></a>2.3 Install KubeSphere</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">~]<span class="comment"># cd /mnt/kubernetes-test/kubesphere-all-offline-v2.1.0/scripts</span></span><br><span class="line">~]<span class="comment"># ./install.#!/bin/sh</span></span><br><span class="line"><span class="comment"># 选择 2 三节点模式安装。</span></span><br><span class="line"><span class="comment">################################################</span></span><br><span class="line">       KubeSphere Installer Menu</span><br><span class="line"><span class="comment">################################################</span></span><br><span class="line">*   1) All-in-one</span><br><span class="line">*   2) Multi-node</span><br><span class="line">*   3) Quit</span><br><span class="line"><span class="comment">################################################</span></span><br><span class="line">https://kubesphere.io/               2020-02-18</span><br><span class="line"><span class="comment">################################################</span></span><br><span class="line">Please input an option: 2</span><br><span class="line"></span><br><span class="line"><span class="comment">#安装过程全自动的，故省略1万字.....  </span></span><br><span class="line"><span class="comment">#根据机器的配置不同，安装的时长也会不同，一般等待时间差不多 50 - 100 分钟。</span></span><br></pre></td></tr></table></figure>
经历了55分钟的等待，我们可以可以看到 Kubernetes 的部署已经完毕….<br><img src="/images/installed-kubernetes.jpg" alt=""><br>KubeSphere 安装完毕~<br><img src="images/kubesphere_end.jpg" alt=""><br>查看 KubeSphere 安装过程<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~]<span class="comment"># kubectl logs -n kubesphere-system $(kubectl get pod -n kubesphere-system -l app=ks-install -o jsonpath=&#123;.items[0].metadata.name&#125;) -f</span></span><br></pre></td></tr></table></figure>
<h3 id="三、结尾写一下遇到的坑吧，都是一些小问题。-PS：细心很重要"><a href="#三、结尾写一下遇到的坑吧，都是一些小问题。-PS：细心很重要" class="headerlink" title="三、结尾写一下遇到的坑吧，都是一些小问题。 PS：细心很重要~"></a>三、结尾写一下遇到的坑吧，都是一些小问题。 PS：细心很重要~</h3><h4 id="3-1-没有合理分配虚拟机资源，导致-install-后-master-节点因为Docker默认存储空间存满直接炸了，脚本运行失败。"><a href="#3-1-没有合理分配虚拟机资源，导致-install-后-master-节点因为Docker默认存储空间存满直接炸了，脚本运行失败。" class="headerlink" title="3.1 没有合理分配虚拟机资源，导致 ./install 后 master 节点因为Docker默认存储空间存满直接炸了，脚本运行失败。"></a>3.1 没有合理分配虚拟机资源，导致 ./install 后 master 节点因为Docker默认存储空间存满直接炸了，脚本运行失败。</h4><h4 id="3-2-在配置-common-yaml-的时候，因为自身主机资源有限，而配置文件又开起了很多功能，在后续安装时-node1-节点直接跑宕机。"><a href="#3-2-在配置-common-yaml-的时候，因为自身主机资源有限，而配置文件又开起了很多功能，在后续安装时-node1-节点直接跑宕机。" class="headerlink" title="3.2 在配置 common.yaml 的时候，因为自身主机资源有限，而配置文件又开起了很多功能，在后续安装时 node1 节点直接跑宕机。"></a>3.2 在配置 common.yaml 的时候，因为自身主机资源有限，而配置文件又开起了很多功能，在后续安装时 node1 节点直接跑宕机。</h4><h4 id="3-3-恢复快照后，防火墙忘了关-端口忘了加-就直接运行脚本会导致后面直接提示-5000-5080-网关找不到或者不通。"><a href="#3-3-恢复快照后，防火墙忘了关-端口忘了加-就直接运行脚本会导致后面直接提示-5000-5080-网关找不到或者不通。" class="headerlink" title="3.3 恢复快照后，防火墙忘了关/端口忘了加 就直接运行脚本会导致后面直接提示 5000/5080 网关找不到或者不通。"></a>3.3 恢复快照后，防火墙忘了关/端口忘了加 就直接运行脚本会导致后面直接提示 5000/5080 网关找不到或者不通。</h4><h4 id="3-4-提示FAILED-RETRYING-download-container-Download-image-if-required-192-168-200-156-5000-coreos-flannel-cni-v0-3-0-Pull不到Flannel-cni-网络插件。"><a href="#3-4-提示FAILED-RETRYING-download-container-Download-image-if-required-192-168-200-156-5000-coreos-flannel-cni-v0-3-0-Pull不到Flannel-cni-网络插件。" class="headerlink" title="3.4 提示FAILED - RETRYING: download_container | Download image if required ( 192.168.200.156:5000/coreos/flannel-cni:v0.3.0 ) Pull不到Flannel-cni 网络插件。"></a>3.4 提示FAILED - RETRYING: download_container | Download image if required ( 192.168.200.156:5000/coreos/flannel-cni:v0.3.0 ) Pull不到Flannel-cni 网络插件。</h4>解决方案（所有节点执行后，重新 ./install ;或者直接使用默认的 Calico 就不会出现该问题。）：<br>docker pull rancher/coreos-flannel-cni:v0.3.0<br>docker tag rancher/coreos-flannel-cni:v0.3.0 192.168.200.156:5000/coreos/flannel-cni:v0.3.0<h4 id="3-5-提示FAILED-RETRYING-download-container-Download-image-if-required-192-168-200-156-5000-coreos-flannel-v0-11-0-参照第4项解决即可，都是images-pull不到。"><a href="#3-5-提示FAILED-RETRYING-download-container-Download-image-if-required-192-168-200-156-5000-coreos-flannel-v0-11-0-参照第4项解决即可，都是images-pull不到。" class="headerlink" title="3.5 提示FAILED - RETRYING: download_container | Download image if required ( 192.168.200.156:5000/coreos/flannel:v0.11.0 ) 参照第4项解决即可，都是images pull不到。"></a>3.5 提示FAILED - RETRYING: download_container | Download image if required ( 192.168.200.156:5000/coreos/flannel:v0.11.0 ) 参照第4项解决即可，都是images pull不到。</h4><h4 id="3-6-KubeSphere-默认生成的证书时间为-10年。-查看方法：openssl-x509-in-etc-kubernetes-pki-ca-crt-noout-text"><a href="#3-6-KubeSphere-默认生成的证书时间为-10年。-查看方法：openssl-x509-in-etc-kubernetes-pki-ca-crt-noout-text" class="headerlink" title="3.6 KubeSphere 默认生成的证书时间为 10年。 查看方法：openssl x509 -in /etc/kubernetes/pki/ca.crt -noout -text"></a>3.6 KubeSphere 默认生成的证书时间为 10年。 查看方法：openssl x509 -in /etc/kubernetes/pki/ca.crt -noout -text</h4><h3 id="四、贴一张离线资源图，虽然我自己也可以awk，懒癌晚期，所以直接复制粘贴了。"><a href="#四、贴一张离线资源图，虽然我自己也可以awk，懒癌晚期，所以直接复制粘贴了。" class="headerlink" title="四、贴一张离线资源图，虽然我自己也可以awk，懒癌晚期，所以直接复制粘贴了。"></a>四、贴一张离线资源图，虽然我自己也可以awk，懒癌晚期，所以直接复制粘贴了。</h3>来源： <a href="https://kubesphere.com.cn/forum/d/149-kubesphere-v2-1-0" target="_blank" rel="noopener"> KubeSphere v2.1.0镜像列表</a>  作者：<a href="https://kubesphere.com.cn/forum/u/zryfish" target="_blank" rel="noopener">zryfish</a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">busybox:1.28.4</span><br><span class="line">calico/kube-controllers:v3.7.3</span><br><span class="line">calico/node:v3.7.3</span><br><span class="line">coredns/coredns:1.6.0</span><br><span class="line">dockerhub.qingcloud.com/coreos/etcd:v3.2.18</span><br><span class="line">dockerhub.qingcloud.com/google_containers/metrics-server-amd64:v0.3.1</span><br><span class="line">dockerhub.qingcloud.com/pires/docker-elasticsearch-curator:5.5.4</span><br><span class="line">gcr.azk8s.cn/google-containers/hyperkube:v1.15.5</span><br><span class="line">gcr.azk8s.cn/google-containers/k8s-dns-node-cache:1.15.5</span><br><span class="line">gcr.azk8s.cn/kubernetes-helm/tiller:v2.14.3</span><br><span class="line">goharbor/chartmuseum-photon:v0.9.0-v1.9.1</span><br><span class="line">goharbor/clair-photon:v2.0.9-v1.9.1</span><br><span class="line">goharbor/harbor-core:v1.9.1</span><br><span class="line">goharbor/harbor-db:v1.9.1</span><br><span class="line">goharbor/harbor-jobservice:v1.9.1</span><br><span class="line">goharbor/harbor-portal:v1.9.1</span><br><span class="line">goharbor/harbor-registryctl:v1.9.1</span><br><span class="line">goharbor/nginx-photon:v1.9.1</span><br><span class="line">goharbor/redis-photon:v1.9.1</span><br><span class="line">goharbor/registry-photon:v2.7.1-patch-2819-2553-v1.9.1</span><br><span class="line">istio/citadel:1.3.3</span><br><span class="line">istio/galley:1.3.3</span><br><span class="line">istio/kubectl:1.3.3</span><br><span class="line">istio/mixer:1.3.3</span><br><span class="line">istio/pilot:1.3.3</span><br><span class="line">istio/proxyv2:1.3.3</span><br><span class="line">istio/sidecar_injector:1.3.3</span><br><span class="line">jaegertracing/jaeger-agent:1.13</span><br><span class="line">jaegertracing/jaeger-collector:1.13</span><br><span class="line">jaegertracing/jaeger-operator:1.13.1</span><br><span class="line">jaegertracing/jaeger-query:1.13</span><br><span class="line">jenkins/jenkins:2.176.2</span><br><span class="line">kubesphere/jenkins-uc:v2.1.0</span><br><span class="line">kubesphere/addon-resizer:1.8.4</span><br><span class="line">kubesphere/alert_adapter:v2.1.0</span><br><span class="line">kubesphere/alerting-dbinit:v2.1.0</span><br><span class="line">kubesphere/alerting:v2.1.0</span><br><span class="line">kubesphere/configmap-reload:v0.0.1</span><br><span class="line">kubesphere/elasticsearch-oss:6.7.0-1</span><br><span class="line">kubesphere/fluent-bit:v1.3.2-reload</span><br><span class="line">kubesphere/fluentbit-operator:v2.1.0</span><br><span class="line">kubesphere/ks-account:v2.1.0</span><br><span class="line">kubesphere/ks-apigateway:v2.1.0</span><br><span class="line">kubesphere/ks-apiserver:v2.1.0</span><br><span class="line">kubesphere/ks-console:v2.1.0</span><br><span class="line">kubesphere/ks-controller-manager:v2.1.0</span><br><span class="line">kubesphere/ks-devops:flyway-v2.1.0</span><br><span class="line">kubesphere/ks-installer:v2.1.0</span><br><span class="line">kubesphere/kube-rbac-proxy:v0.4.1</span><br><span class="line">kubesphere/kube-state-metrics:v1.5.2</span><br><span class="line">kubesphere/kubectl:v1.0.0</span><br><span class="line">kubesphere/<span class="built_in">log</span>-sidecar-injector:1.0</span><br><span class="line">kubesphere/node-exporter:ks-v0.16.0</span><br><span class="line">kubesphere/notification:flyway_v2.1.0</span><br><span class="line">kubesphere/notification:v2.1.0</span><br><span class="line">kubesphere/prometheus-config-reloader:v0.27.1</span><br><span class="line">kubesphere/prometheus-operator:v0.27.1</span><br><span class="line">kubesphere/prometheus:v2.5.0</span><br><span class="line">kubesphere/s2ioperator:v2.1.0</span><br><span class="line">minio/minio:RELEASE.2019-08-07T01-59-21Z</span><br><span class="line">mirrorgitlabcontainers/kubectl:v1.12.10</span><br><span class="line">mirrorgooglecontainers/cluster-proportional-autoscaler-amd64:1.6.0</span><br><span class="line">mirrorgooglecontainers/defaultbackend-amd64:1.4</span><br><span class="line">mysql:8.0.11</span><br><span class="line">nginx:1.14-alpine</span><br><span class="line">openpitrix/openpitrix:flyway-v0.4.5</span><br><span class="line">openpitrix/openpitrix:v0.4.5</span><br><span class="line">openpitrix/release-app:v0.4.2</span><br><span class="line">openpitrix/runtime-provider-kubernetes:v0.1.2</span><br><span class="line">osixia/openldap:1.3.0</span><br><span class="line">quay.azk8s.cn/openebs/node-disk-manager-amd64:v0.4.1</span><br><span class="line">quay.azk8s.cn/openebs/node-disk-operator-amd64:v0.4.1</span><br><span class="line">quay.azk8s.cn/openebs/provisioner-localpv:1.1.0</span><br><span class="line">redis:5.0.5-alpine</span><br></pre></td></tr></table></figure>
<h3 id="五、关于-UI-界面…"><a href="#五、关于-UI-界面…" class="headerlink" title="五、关于 UI 界面…."></a>五、关于 UI 界面….</h3><img src="/images/kubesphere_web.jpg" alt=""><br><img src="/images/kubesphere_pc.jpg" alt=""><br><img src="/images/kubesphere_cctv.jpg" alt=""><br><img src="/images/kubesphere_service_cctv.jpg" alt=""><h3 id="六、参考链接："><a href="#六、参考链接：" class="headerlink" title="六、参考链接："></a>六、参考链接：</h3><a href="https://kubesphere.com.cn/forum/" target="_blank" rel="noopener">KubeSphere 开发者社区</a><br><a href="https://kubesphere.com.cn/docs/zh-CN/" target="_blank" rel="noopener">KubeSphere 文档</a></li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/categories/" rel="tag"># categories</a>
              <a href="/tags/books/" rel="tag"># books</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/02/08/tomcat_install/" rel="prev" title="记录 Tomcat 的安装与配置">
      <i class="fa fa-chevron-left"></i> 记录 Tomcat 的安装与配置
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/03/23/Elasticsearch-install/" rel="next" title="爬过一个个部署ELk的坑">
      爬过一个个部署ELk的坑 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    <div class="comments" id="comments"></div>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#前言："><span class="nav-text">前言：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#一、优化Linux-系统"><span class="nav-text">一、优化Linux 系统</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-准备三台-Centos-7-6-主机-虚拟机"><span class="nav-text">1.1 准备三台 Centos 7.6 主机&#x2F;虚拟机</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-更改主机-hostname-并将三台主机的主机名与IP写入-etc-hosts-中"><span class="nav-text">1.2 更改主机 hostname 并将三台主机的主机名与IP写入 &#x2F;etc&#x2F;hosts 中</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-关闭防火墙、Selinux、Swap-交换分区"><span class="nav-text">1.3 关闭防火墙、Selinux、Swap 交换分区</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-4-关闭系统不需要的服务"><span class="nav-text">1.4 关闭系统不需要的服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-5-设置rsyslogd-和-systemd-journald"><span class="nav-text">1.5 设置rsyslogd 和 systemd journald</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-6-调整内核参数，针对于K8s"><span class="nav-text">1.6 调整内核参数，针对于K8s</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-7-将Centos-7-6-的内核升级到4-0版本或者4-0版本以上"><span class="nav-text">1.7 将Centos 7.6 的内核升级到4.0版本或者4.0版本以上</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-8-配置-kube-proxy-开启-ipvs-的前置条件（此操作可以不用进行，但可以用于-kubeadm-部署方式开启-kube-proxy-ipvs）"><span class="nav-text">1.8 配置 kube-proxy 开启 ipvs 的前置条件（此操作可以不用进行，但可以用于 kubeadm 部署方式开启 kube-proxy ipvs）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二、安装-KubeSphere"><span class="nav-text">二、安装 KubeSphere</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-拉取-KubeSphere-离线安装包并分配磁盘空间"><span class="nav-text">2.1 拉取 KubeSphere 离线安装包并分配磁盘空间</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-1-1-KubeSphere-载点："><span class="nav-text">2.1.1 KubeSphere 载点：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-1-2-master节点创建磁盘3、4："><span class="nav-text">2.1.2 master节点创建磁盘3、4：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-1-3-初始化磁盘并解压离线包："><span class="nav-text">2.1.3 初始化磁盘并解压离线包：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-1-4-根据自己的需求配置-common-yaml-插件目录"><span class="nav-text">2.1.4 根据自己的需求配置 common.yaml 插件目录</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-根据刚才配置的-common-yaml-文件安装我们需要的-Nfs-存储"><span class="nav-text">2.2 根据刚才配置的 common.yaml 文件安装我们需要的 Nfs 存储</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-2-1-为-Gitlab-和-Harbor-添加本地解析（自己的PC电脑也需要添加解析才能正常访问哦）"><span class="nav-text">2.2.1 为 Gitlab 和 Harbor 添加本地解析（自己的PC电脑也需要添加解析才能正常访问哦）</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-Install-KubeSphere"><span class="nav-text">2.3 Install KubeSphere</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#三、结尾写一下遇到的坑吧，都是一些小问题。-PS：细心很重要"><span class="nav-text">三、结尾写一下遇到的坑吧，都是一些小问题。 PS：细心很重要~</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-没有合理分配虚拟机资源，导致-install-后-master-节点因为Docker默认存储空间存满直接炸了，脚本运行失败。"><span class="nav-text">3.1 没有合理分配虚拟机资源，导致 .&#x2F;install 后 master 节点因为Docker默认存储空间存满直接炸了，脚本运行失败。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-在配置-common-yaml-的时候，因为自身主机资源有限，而配置文件又开起了很多功能，在后续安装时-node1-节点直接跑宕机。"><span class="nav-text">3.2 在配置 common.yaml 的时候，因为自身主机资源有限，而配置文件又开起了很多功能，在后续安装时 node1 节点直接跑宕机。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-恢复快照后，防火墙忘了关-端口忘了加-就直接运行脚本会导致后面直接提示-5000-5080-网关找不到或者不通。"><span class="nav-text">3.3 恢复快照后，防火墙忘了关&#x2F;端口忘了加 就直接运行脚本会导致后面直接提示 5000&#x2F;5080 网关找不到或者不通。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-提示FAILED-RETRYING-download-container-Download-image-if-required-192-168-200-156-5000-coreos-flannel-cni-v0-3-0-Pull不到Flannel-cni-网络插件。"><span class="nav-text">3.4 提示FAILED - RETRYING: download_container | Download image if required ( 192.168.200.156:5000&#x2F;coreos&#x2F;flannel-cni:v0.3.0 ) Pull不到Flannel-cni 网络插件。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-提示FAILED-RETRYING-download-container-Download-image-if-required-192-168-200-156-5000-coreos-flannel-v0-11-0-参照第4项解决即可，都是images-pull不到。"><span class="nav-text">3.5 提示FAILED - RETRYING: download_container | Download image if required ( 192.168.200.156:5000&#x2F;coreos&#x2F;flannel:v0.11.0 ) 参照第4项解决即可，都是images pull不到。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-6-KubeSphere-默认生成的证书时间为-10年。-查看方法：openssl-x509-in-etc-kubernetes-pki-ca-crt-noout-text"><span class="nav-text">3.6 KubeSphere 默认生成的证书时间为 10年。 查看方法：openssl x509 -in &#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;ca.crt -noout -text</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#四、贴一张离线资源图，虽然我自己也可以awk，懒癌晚期，所以直接复制粘贴了。"><span class="nav-text">四、贴一张离线资源图，虽然我自己也可以awk，懒癌晚期，所以直接复制粘贴了。</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#五、关于-UI-界面…"><span class="nav-text">五、关于 UI 界面….</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#六、参考链接："><span class="nav-text">六、参考链接：</span></a></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Zoey Zhou"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Zoey Zhou</p>
  <div class="site-description" itemprop="description">纸上谈来终觉浅，唯有实践出真知</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
        
          <span class="site-state-item-count">7</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zhoutao1231" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zhoutao1231" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zt970421@gmail.com" title="E-Mail → mailto:zt970421@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.facebook.com/" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;" rel="noopener" target="_blank"><i class="fa fa-fw fa-facebook"></i>FB Page</a>
      </span>
      <span class="links-of-author-item">
        <a href="skype:zt970421?call|chat" title="Skype → skype:zt970421?call|chat" rel="noopener" target="_blank"><i class="fa fa-fw fa-skype"></i>Skype</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-fw fa-rss"></i>RSS</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      推荐阅读
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://www.uisdc.com/" title="http:&#x2F;&#x2F;www.uisdc.com&#x2F;" rel="noopener" target="_blank">优设</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.zhangxinxu.com/" title="http:&#x2F;&#x2F;www.zhangxinxu.com&#x2F;" rel="noopener" target="_blank">张鑫旭</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.alloyteam.com/nav/" title="http:&#x2F;&#x2F;www.alloyteam.com&#x2F;nav&#x2F;" rel="noopener" target="_blank">Web前端导航</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.36zhen.com/t?id=3448" title="http:&#x2F;&#x2F;www.36zhen.com&#x2F;t?id&#x3D;3448" rel="noopener" target="_blank">前端书籍资料</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://ife.baidu.com/" title="http:&#x2F;&#x2F;ife.baidu.com&#x2F;" rel="noopener" target="_blank">百度前端技术学院</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://wf.uisdc.com/cn/" title="http:&#x2F;&#x2F;wf.uisdc.com&#x2F;cn&#x2F;" rel="noopener" target="_blank">google前端开发基础</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zoey Zhou</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">61k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">56 分钟</span>
</div>

<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_pv"></span>
</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.6.0
  </div>   <span>| 本站已运行<span id="htmer_time"></span> | </span>
<script>
    function secondToDate(second) {
        if (!second) {
            return 0;
        }
        var time = new Array(0, 0, 0, 0, 0);
        if (second >= 365 * 24 * 3600) {
            time[0] = parseInt(second / (365 * 24 * 3600));
            second %= 365 * 24 * 3600;
        }
        if (second >= 24 * 3600) {
            time[1] = parseInt(second / (24 * 3600));
            second %= 24 * 3600;
        }
        if (second >= 3600) {
            time[2] = parseInt(second / 3600);
            second %= 3600;
        }
        if (second >= 60) {
            time[3] = parseInt(second / 60);
            second %= 60;
        }
        if (second > 0) {
            time[4] = second;
        }
        return time;
    }
    </script>

<script type="text/javascript" language="javascript">
    function setTime() {
        var create_time = Math.round(new Date(Date.UTC(2019, 10, 20, 14, 0, 0)).getTime() / 1000);  //这里设置建站时间
        var timestamp = Math.round((new Date().getTime() + 8 * 60 * 60 * 1000) / 1000);
        currentTime = secondToDate((timestamp - create_time));
        currentTimeHtml = currentTime[0] + '年' + currentTime[1] + '天'
                + currentTime[2] + '时' + currentTime[3] + '分' + currentTime[4]
                + '秒';
        document.getElementById("htmer_time").innerHTML = currentTimeHtml;
    }    setInterval(setTime, 1000);

        $(function(){
            $("#learnmore").click(function(){
                if (location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') && location.hostname == this.hostname) {
                    var $target = $(this.hash);
                    $target = $target.length && $target || $('[name=' + this.hash.slice(1) + ']');
                    if ($target.length) {
                        var targetOffset = $target.offset().top;
                    $('html,body').animate({scrollTop: targetOffset},800);
                    return false;
                    }
                }
            });
        });

</script>


<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共20.2k字</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>






  <script>
  function leancloudSelector(url) {
    return document.getElementById(url).querySelector('.leancloud-visitors-count');
  }
  if (CONFIG.page.isPost) {
    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = visitors.getAttribute('id').trim();
      var title = visitors.getAttribute('data-flag-title').trim();

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .then(response => response.json())
              .then(() => {
                leancloudSelector(url).innerText = counter.time + 1;
              })
              .catch(error => {
                console.log('Failed to save visitor count', error);
              })
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.log('LeanCloud Counter Error', error);
        });
    }
  } else {
    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return element.getAttribute('id').trim();
      });

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url: { '$in': entries } })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length === 0) {
            document.querySelectorAll('.leancloud_visitors .leancloud-visitors-count').forEach(element => {
              element.innerText = 0;
            });
            return;
          }
          for (let item of results) {
            let { url, time } = item;
            leancloudSelector(url).innerText = time;
          }
          for (let url of entries) {
            var element = leancloudSelector(url);
            if (element.innerText == '') {
              element.innerText = 0;
            }
          }
        })
        .catch(error => {
          console.log('LeanCloud Counter Error', error);
        });
    }
  }

  fetch('https://app-router.leancloud.cn/2/route?appId=JX2cVSIs1yxlbkUMagQzzMAB-MdYXbMMI')
    .then(response => response.json())
    .then(({ api_server }) => {
      var Counter = (method, url, data) => {
        return fetch(`https://${api_server}/1.1${url}`, {
          method: method,
          headers: {
            'X-LC-Id': 'JX2cVSIs1yxlbkUMagQzzMAB-MdYXbMMI',
            'X-LC-Key': 'eSkiG5GatWsEOBVz8aN45297',
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    });
  </script>


        
      </div>
    </footer>
  </div>

  
  
  <script color='0,0,0' opacity='0.8' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
















  

  


<script>
NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(item => {
    return GUEST.includes(item);
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: 'JX2cVSIs1yxlbkUMagQzzMAB-MdYXbMMI',
    appKey: 'eSkiG5GatWsEOBVz8aN45297',
    placeholder: "Just go go",
    avatar: 'retro',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false,
    lang: '' || 'zh-cn',
    path: location.pathname,
    recordIP: false,
    serverURLs: ''
  });
}, window.Valine);
</script>

  <!-- 自建特效存放目录 source/js/src and layout/_custom/custom.swig -->
  
<!-- 图片轮播js文件cdn -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>
<!-- 自定义的js文件 -->
<script type="text/javascript" src="/js/src/custom.js"></script>



  <script async src="/js/src/fireworks.js"></script>




  <script src="/js/src/activate-power-mode.js"></script>
  <script>
    POWERMODE.colorful = true;
    POWERMODE.shake = false;
    document.body.addEventListener('input', POWERMODE);
  </script>




<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"scale":1.2,"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"left","width":300,"height":600,"hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.75,"opacityOnHover":0.8},"log":false});</script></body>
</html>
